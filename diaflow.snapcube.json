[
    {
        "fileName": ".gitignore",
        "filePath": "diaflow",
        "content": "node_modules\ndist\n",
        "isBinary": false,
        "encoding": "utf-8"
    },
    {
        "fileName": "package.json",
        "filePath": "diaflow",
        "content": "{\n  \"name\": \"diaflow\",\n  \"version\": \"1.0.0\",\n  \"main\": \"dist/index.js\",\n  \"license\": \"MIT\",\n  \"description\": \"DiaFlow â€” agent orchestration for Gemini (tools + structured output)\",\n  \"types\": \"dist/index.d.ts\",\n  \"repository\": {\n    \"type\": \"git\",\n    \"url\": \"https://github.com/tanmayvaij/diaflow.git\"\n  },\n  \"homepage\": \"https://github.com/tanmayvaij/diaflow\",\n  \"bugs\": {\n    \"url\": \"https://github.com/tanmayvaij/diaflow/issues\"\n  },\n  \"keywords\": [\n    \"ai\",\n    \"agents\",\n    \"gemini\",\n    \"diaflow\"\n  ],\n  \"scripts\": {\n    \"build\": \"tsc\",\n    \"prepublishOnly\": \"yarn build\"\n  },\n  \"dependencies\": {\n    \"@google/genai\": \"^1.20.0\",\n    \"dotenv\": \"^17.2.2\",\n    \"zod\": \"^4.1.11\"\n  },\n  \"devDependencies\": {\n    \"@types/node\": \"^24.5.2\",\n    \"typescript\": \"^5.9.2\"\n  }\n}\n",
        "isBinary": false,
        "encoding": "utf-8"
    },
    {
        "fileName": "index.ts",
        "filePath": "diaflow/src/@types",
        "content": "import { FunctionDeclaration } from \"@google/genai\";\n\nexport interface Tool {\n  declaration: FunctionDeclaration;\n  handler: (args: any) => Promise<any> | any;\n}\n\nexport type GeminiModels =\n  | \"gemini-2.5-pro\"\n  | \"gemini-2.5-flash\"\n  | \"gemini-2.5-flash-lite\"\n  | \"gemini-2.5-flash-image\"\n  | \"gemini-2.0-flash\"\n  | \"gemini-2.0-flash-lite\";\n",
        "isBinary": false,
        "encoding": "utf-8"
    },
    {
        "fileName": "index.ts",
        "filePath": "diaflow/src",
        "content": "import { Content, GenerateContentConfig, GoogleGenAI } from \"@google/genai\";\nimport { Memory } from \"./memory\";\nimport * as z from \"zod\";\nimport { GeminiModels, Tool } from \"./@types\";\n\nexport default class DiaFlowAgent {\n  private ai: GoogleGenAI;\n  private config: GenerateContentConfig;\n  private toolsMap: Record<string, (args: any) => any | Promise<any>>;\n  private model: GeminiModels;\n  private memory: Memory | undefined;\n  private responseJsonSchema: z.ZodObject<any> | undefined;\n  private contents: Content[] = [];\n\n  constructor({\n    apiKey,\n    config,\n    tools,\n    model = \"gemini-2.0-flash\",\n    memory,\n    responseJsonSchema,\n  }: {\n    apiKey: string;\n    config?: GenerateContentConfig;\n    tools?: Tool[];\n    model?: GeminiModels;\n    responseJsonSchema?: z.ZodObject;\n    memory?: Memory;\n  }) {\n    this.ai = new GoogleGenAI({ apiKey });\n    this.model = model;\n    this.config = {\n      ...config,\n      tools: tools\n        ? [{ functionDeclarations: tools.map((tool) => tool.declaration) }]\n        : [],\n    };\n    this.toolsMap = Object.fromEntries(\n      tools?.map((tool) => [tool.declaration.name, tool.handler]) ?? []\n    );\n    this.memory = memory;\n    this.responseJsonSchema = responseJsonSchema;\n  }\n\n  private getHistory() {\n    return this.memory ? this.memory.getContent() : this.contents;\n  }\n\n  private addToHistory(content: Content) {\n    if (this.memory) this.memory.add(content);\n    else this.contents.push(content);\n  }\n\n  async runAgent(text: string) {\n    this.addToHistory({\n      role: \"user\",\n      parts: [{ text }],\n    });\n\n    while (true) {\n      const response = await this.ai.models.generateContent({\n        model: this.model,\n        config: this.config || {},\n        contents: this.getHistory(),\n      });\n\n      if (response.functionCalls && response.functionCalls.length > 0) {\n        const functionCall = response.functionCalls[0]!;\n\n        console.log(`functionCall  ->  ${JSON.stringify(functionCall)}`);\n\n        const { name, args } = functionCall;\n\n        const toolResponse = await this.toolsMap[name as string]!(args as any);\n\n        console.log(`toolResponse  ->  ${JSON.stringify(toolResponse)}`);\n\n        this.addToHistory({\n          role: \"model\",\n          parts: [\n            {\n              functionCall,\n            },\n          ],\n        });\n        this.addToHistory({\n          role: \"user\",\n          parts: [\n            {\n              functionResponse: {\n                name: name!,\n                response: { result: toolResponse },\n              },\n            },\n          ],\n        });\n\n        continue;\n      }\n\n      if (this.responseJsonSchema) {\n        const formattedResponse = await this.ai.models.generateContent({\n          model: this.model,\n          config: {\n            responseMimeType: \"application/json\",\n            responseJsonSchema: z.toJSONSchema(this.responseJsonSchema),\n            systemInstruction:\n              \"You are a formatter agent, your only job is to format data into the required json structure\",\n          },\n          contents: this.getHistory(),\n        });\n\n        return this.responseJsonSchema.parse(\n          JSON.parse(formattedResponse.text!)\n        );\n      }\n\n      return response.text;\n    }\n  }\n}\n",
        "isBinary": false,
        "encoding": "utf-8"
    },
    {
        "fileName": "memory.ts",
        "filePath": "diaflow/src",
        "content": "import { Content } from \"@google/genai\";\n\nexport class Memory {\n  private contents: Content[] = [];\n\n  add(entry: Content) {\n    this.contents.push(entry);\n  }\n\n  getContent(): Content[] {\n    return this.contents;\n  }\n\n}\n",
        "isBinary": false,
        "encoding": "utf-8"
    },
    {
        "fileName": "tsconfig.json",
        "filePath": "diaflow",
        "content": "{\n  // Visit https://aka.ms/tsconfig to read more about this file\n  \"compilerOptions\": {\n    // File Layout\n    \"rootDir\": \"./src\",\n    \"outDir\": \"./dist\",\n\n    // Environment Settings\n    // See also https://aka.ms/tsconfig/module\n    \"module\": \"nodenext\",\n    \"target\": \"esnext\",\n    // \"types\": [],\n    // For nodejs:\n    \"lib\": [\"esnext\"],\n    \"types\": [\"node\"],\n    // and npm install -D @types/node\n\n    // Other Outputs\n    \"sourceMap\": true,\n    \"declaration\": true,\n    \"declarationMap\": true,\n\n    // Stricter Typechecking Options\n    \"noUncheckedIndexedAccess\": true,\n    \"exactOptionalPropertyTypes\": true,\n\n    // Style Options\n    // \"noImplicitReturns\": true,\n    // \"noImplicitOverride\": true,\n    // \"noUnusedLocals\": true,\n    // \"noUnusedParameters\": true,\n    // \"noFallthroughCasesInSwitch\": true,\n    // \"noPropertyAccessFromIndexSignature\": true,\n\n    // Recommended Options\n    \"strict\": true,\n    \"jsx\": \"react-jsx\",\n    \"verbatimModuleSyntax\": false,\n    \"isolatedModules\": true,\n    \"noUncheckedSideEffectImports\": true,\n    \"moduleDetection\": \"force\",\n    \"skipLibCheck\": true,\n  }\n}\n",
        "isBinary": false,
        "encoding": "utf-8"
    },
    {
        "fileName": "yarn.lock",
        "filePath": "diaflow",
        "content": "# THIS IS AN AUTOGENERATED FILE. DO NOT EDIT THIS FILE DIRECTLY.\n# yarn lockfile v1\n\n\n\"@google/genai@^1.20.0\":\n  version \"1.20.0\"\n  resolved \"https://registry.yarnpkg.com/@google/genai/-/genai-1.20.0.tgz#b728bdb383fc58fbb1b92eff26e831ff598688c0\"\n  integrity sha512-QdShxO9LX35jFogy3iKprQNqgKKveux4H2QjOnyIvyHRuGi6PHiz3fjNf8Y0VPY8o5V2fHqR2XqiSVoz7yZs0w==\n  dependencies:\n    google-auth-library \"^9.14.2\"\n    ws \"^8.18.0\"\n\n\"@types/node@^24.5.2\":\n  version \"24.5.2\"\n  resolved \"https://registry.yarnpkg.com/@types/node/-/node-24.5.2.tgz#52ceb83f50fe0fcfdfbd2a9fab6db2e9e7ef6446\"\n  integrity sha512-FYxk1I7wPv3K2XBaoyH2cTnocQEu8AOZ60hPbsyukMPLv5/5qr7V1i8PLHdl6Zf87I+xZXFvPCXYjiTFq+YSDQ==\n  dependencies:\n    undici-types \"~7.12.0\"\n\nagent-base@^7.1.2:\n  version \"7.1.4\"\n  resolved \"https://registry.yarnpkg.com/agent-base/-/agent-base-7.1.4.tgz#e3cd76d4c548ee895d3c3fd8dc1f6c5b9032e7a8\"\n  integrity sha512-MnA+YT8fwfJPgBx3m60MNqakm30XOkyIoH1y6huTQvC0PwZG7ki8NacLBcrPbNoo8vEZy7Jpuk7+jMO+CUovTQ==\n\nbase64-js@^1.3.0:\n  version \"1.5.1\"\n  resolved \"https://registry.yarnpkg.com/base64-js/-/base64-js-1.5.1.tgz#1b1b440160a5bf7ad40b650f095963481903930a\"\n  integrity sha512-AKpaYlHn8t4SVbOHCy+b5+KKgvR4vrsD8vbvrbiQJps7fKDTkjkDry6ji0rUJjC0kzbNePLwzxq8iypo41qeWA==\n\nbignumber.js@^9.0.0:\n  version \"9.3.1\"\n  resolved \"https://registry.yarnpkg.com/bignumber.js/-/bignumber.js-9.3.1.tgz#759c5aaddf2ffdc4f154f7b493e1c8770f88c4d7\"\n  integrity sha512-Ko0uX15oIUS7wJ3Rb30Fs6SkVbLmPBAKdlm7q9+ak9bbIeFf0MwuBsQV6z7+X768/cHsfg+WlysDWJcmthjsjQ==\n\nbuffer-equal-constant-time@^1.0.1:\n  version \"1.0.1\"\n  resolved \"https://registry.yarnpkg.com/buffer-equal-constant-time/-/buffer-equal-constant-time-1.0.1.tgz#f8e71132f7ffe6e01a5c9697a4c6f3e48d5cc819\"\n  integrity sha512-zRpUiDwd/xk6ADqPMATG8vc9VPrkck7T07OIx0gnjmJAnHnTVXNQG3vfvWNuiZIkwu9KrKdA1iJKfsfTVxE6NA==\n\ndebug@4:\n  version \"4.4.3\"\n  resolved \"https://registry.yarnpkg.com/debug/-/debug-4.4.3.tgz#c6ae432d9bd9662582fce08709b038c58e9e3d6a\"\n  integrity sha512-RGwwWnwQvkVfavKVt22FGLw+xYSdzARwm0ru6DhTVA3umU5hZc28V3kO4stgYryrTlLpuvgI9GiijltAjNbcqA==\n  dependencies:\n    ms \"^2.1.3\"\n\ndotenv@^17.2.2:\n  version \"17.2.2\"\n  resolved \"https://registry.yarnpkg.com/dotenv/-/dotenv-17.2.2.tgz#4010cfe1c2be4fc0f46fd3d951afb424bc067ac6\"\n  integrity sha512-Sf2LSQP+bOlhKWWyhFsn0UsfdK/kCWRv1iuA2gXAwt3dyNabr6QSj00I2V10pidqz69soatm9ZwZvpQMTIOd5Q==\n\necdsa-sig-formatter@1.0.11, ecdsa-sig-formatter@^1.0.11:\n  version \"1.0.11\"\n  resolved \"https://registry.yarnpkg.com/ecdsa-sig-formatter/-/ecdsa-sig-formatter-1.0.11.tgz#ae0f0fa2d85045ef14a817daa3ce9acd0489e5bf\"\n  integrity sha512-nagl3RYrbNv6kQkeJIpt6NJZy8twLB/2vtz6yN9Z4vRKHN4/QZJIEbqohALSgwKdnksuY3k5Addp5lg8sVoVcQ==\n  dependencies:\n    safe-buffer \"^5.0.1\"\n\nextend@^3.0.2:\n  version \"3.0.2\"\n  resolved \"https://registry.yarnpkg.com/extend/-/extend-3.0.2.tgz#f8b1136b4071fbd8eb140aff858b1019ec2915fa\"\n  integrity sha512-fjquC59cD7CyW6urNXK0FBufkZcoiGG80wTuPujX590cB5Ttln20E2UB4S/WARVqhXffZl2LNgS+gQdPIIim/g==\n\ngaxios@^6.0.0, gaxios@^6.1.1:\n  version \"6.7.1\"\n  resolved \"https://registry.yarnpkg.com/gaxios/-/gaxios-6.7.1.tgz#ebd9f7093ede3ba502685e73390248bb5b7f71fb\"\n  integrity sha512-LDODD4TMYx7XXdpwxAVRAIAuB0bzv0s+ywFonY46k126qzQHT9ygyoa9tncmOiQmmDrik65UYsEkv3lbfqQ3yQ==\n  dependencies:\n    extend \"^3.0.2\"\n    https-proxy-agent \"^7.0.1\"\n    is-stream \"^2.0.0\"\n    node-fetch \"^2.6.9\"\n    uuid \"^9.0.1\"\n\ngcp-metadata@^6.1.0:\n  version \"6.1.1\"\n  resolved \"https://registry.yarnpkg.com/gcp-metadata/-/gcp-metadata-6.1.1.tgz#f65aa69f546bc56e116061d137d3f5f90bdec494\"\n  integrity sha512-a4tiq7E0/5fTjxPAaH4jpjkSv/uCaU2p5KC6HVGrvl0cDjA8iBZv4vv1gyzlmK0ZUKqwpOyQMKzZQe3lTit77A==\n  dependencies:\n    gaxios \"^6.1.1\"\n    google-logging-utils \"^0.0.2\"\n    json-bigint \"^1.0.0\"\n\ngoogle-auth-library@^9.14.2:\n  version \"9.15.1\"\n  resolved \"https://registry.yarnpkg.com/google-auth-library/-/google-auth-library-9.15.1.tgz#0c5d84ed1890b2375f1cd74f03ac7b806b392928\"\n  integrity sha512-Jb6Z0+nvECVz+2lzSMt9u98UsoakXxA2HGHMCxh+so3n90XgYWkq5dur19JAJV7ONiJY22yBTyJB1TSkvPq9Ng==\n  dependencies:\n    base64-js \"^1.3.0\"\n    ecdsa-sig-formatter \"^1.0.11\"\n    gaxios \"^6.1.1\"\n    gcp-metadata \"^6.1.0\"\n    gtoken \"^7.0.0\"\n    jws \"^4.0.0\"\n\ngoogle-logging-utils@^0.0.2:\n  version \"0.0.2\"\n  resolved \"https://registry.yarnpkg.com/google-logging-utils/-/google-logging-utils-0.0.2.tgz#5fd837e06fa334da450433b9e3e1870c1594466a\"\n  integrity sha512-NEgUnEcBiP5HrPzufUkBzJOD/Sxsco3rLNo1F1TNf7ieU8ryUzBhqba8r756CjLX7rn3fHl6iLEwPYuqpoKgQQ==\n\ngtoken@^7.0.0:\n  version \"7.1.0\"\n  resolved \"https://registry.yarnpkg.com/gtoken/-/gtoken-7.1.0.tgz#d61b4ebd10132222817f7222b1e6064bd463fc26\"\n  integrity sha512-pCcEwRi+TKpMlxAQObHDQ56KawURgyAf6jtIY046fJ5tIv3zDe/LEIubckAO8fj6JnAxLdmWkUfNyulQ2iKdEw==\n  dependencies:\n    gaxios \"^6.0.0\"\n    jws \"^4.0.0\"\n\nhttps-proxy-agent@^7.0.1:\n  version \"7.0.6\"\n  resolved \"https://registry.yarnpkg.com/https-proxy-agent/-/https-proxy-agent-7.0.6.tgz#da8dfeac7da130b05c2ba4b59c9b6cd66611a6b9\"\n  integrity sha512-vK9P5/iUfdl95AI+JVyUuIcVtd4ofvtrOr3HNtM2yxC9bnMbEdp3x01OhQNnjb8IJYi38VlTE3mBXwcfvywuSw==\n  dependencies:\n    agent-base \"^7.1.2\"\n    debug \"4\"\n\nis-stream@^2.0.0:\n  version \"2.0.1\"\n  resolved \"https://registry.yarnpkg.com/is-stream/-/is-stream-2.0.1.tgz#fac1e3d53b97ad5a9d0ae9cef2389f5810a5c077\"\n  integrity sha512-hFoiJiTl63nn+kstHGBtewWSKnQLpyb155KHheA1l39uvtO9nWIop1p3udqPcUd/xbF1VLMO4n7OI6p7RbngDg==\n\njson-bigint@^1.0.0:\n  version \"1.0.0\"\n  resolved \"https://registry.yarnpkg.com/json-bigint/-/json-bigint-1.0.0.tgz#ae547823ac0cad8398667f8cd9ef4730f5b01ff1\"\n  integrity sha512-SiPv/8VpZuWbvLSMtTDU8hEfrZWg/mH/nV/b4o0CYbSxu1UIQPLdwKOCIyLQX+VIPO5vrLX3i8qtqFyhdPSUSQ==\n  dependencies:\n    bignumber.js \"^9.0.0\"\n\njwa@^2.0.0:\n  version \"2.0.1\"\n  resolved \"https://registry.yarnpkg.com/jwa/-/jwa-2.0.1.tgz#bf8176d1ad0cd72e0f3f58338595a13e110bc804\"\n  integrity sha512-hRF04fqJIP8Abbkq5NKGN0Bbr3JxlQ+qhZufXVr0DvujKy93ZCbXZMHDL4EOtodSbCWxOqR8MS1tXA5hwqCXDg==\n  dependencies:\n    buffer-equal-constant-time \"^1.0.1\"\n    ecdsa-sig-formatter \"1.0.11\"\n    safe-buffer \"^5.0.1\"\n\njws@^4.0.0:\n  version \"4.0.0\"\n  resolved \"https://registry.yarnpkg.com/jws/-/jws-4.0.0.tgz#2d4e8cf6a318ffaa12615e9dec7e86e6c97310f4\"\n  integrity sha512-KDncfTmOZoOMTFG4mBlG0qUIOlc03fmzH+ru6RgYVZhPkyiy/92Owlt/8UEN+a4TXR1FQetfIpJE8ApdvdVxTg==\n  dependencies:\n    jwa \"^2.0.0\"\n    safe-buffer \"^5.0.1\"\n\nms@^2.1.3:\n  version \"2.1.3\"\n  resolved \"https://registry.yarnpkg.com/ms/-/ms-2.1.3.tgz#574c8138ce1d2b5861f0b44579dbadd60c6615b2\"\n  integrity sha512-6FlzubTLZG3J2a/NVCAleEhjzq5oxgHyaCU9yYXvcLsvoVaHJq/s5xXI6/XXP6tz7R9xAOtHnSO/tXtF3WRTlA==\n\nnode-fetch@^2.6.9:\n  version \"2.7.0\"\n  resolved \"https://registry.yarnpkg.com/node-fetch/-/node-fetch-2.7.0.tgz#d0f0fa6e3e2dc1d27efcd8ad99d550bda94d187d\"\n  integrity sha512-c4FRfUm/dbcWZ7U+1Wq0AwCyFL+3nt2bEw05wfxSz+DWpWsitgmSgYmy2dQdWyKC1694ELPqMs/YzUSNozLt8A==\n  dependencies:\n    whatwg-url \"^5.0.0\"\n\nsafe-buffer@^5.0.1:\n  version \"5.2.1\"\n  resolved \"https://registry.yarnpkg.com/safe-buffer/-/safe-buffer-5.2.1.tgz#1eaf9fa9bdb1fdd4ec75f58f9cdb4e6b7827eec6\"\n  integrity sha512-rp3So07KcdmmKbGvgaNxQSJr7bGVSVk5S9Eq1F+ppbRo70+YeaDxkw5Dd8NPN+GD6bjnYm2VuPuCXmpuYvmCXQ==\n\ntr46@~0.0.3:\n  version \"0.0.3\"\n  resolved \"https://registry.yarnpkg.com/tr46/-/tr46-0.0.3.tgz#8184fd347dac9cdc185992f3a6622e14b9d9ab6a\"\n  integrity sha512-N3WMsuqV66lT30CrXNbEjx4GEwlow3v6rr4mCcv6prnfwhS01rkgyFdjPNBYd9br7LpXV1+Emh01fHnq2Gdgrw==\n\ntypescript@^5.9.2:\n  version \"5.9.2\"\n  resolved \"https://registry.yarnpkg.com/typescript/-/typescript-5.9.2.tgz#d93450cddec5154a2d5cabe3b8102b83316fb2a6\"\n  integrity sha512-CWBzXQrc/qOkhidw1OzBTQuYRbfyxDXJMVJ1XNwUHGROVmuaeiEm3OslpZ1RV96d7SKKjZKrSJu3+t/xlw3R9A==\n\nundici-types@~7.12.0:\n  version \"7.12.0\"\n  resolved \"https://registry.yarnpkg.com/undici-types/-/undici-types-7.12.0.tgz#15c5c7475c2a3ba30659529f5cdb4674b622fafb\"\n  integrity sha512-goOacqME2GYyOZZfb5Lgtu+1IDmAlAEu5xnD3+xTzS10hT0vzpf0SPjkXwAw9Jm+4n/mQGDP3LO8CPbYROeBfQ==\n\nuuid@^9.0.1:\n  version \"9.0.1\"\n  resolved \"https://registry.yarnpkg.com/uuid/-/uuid-9.0.1.tgz#e188d4c8853cc722220392c424cd637f32293f30\"\n  integrity sha512-b+1eJOlsR9K8HJpow9Ok3fiWOWSIcIzXodvv0rQjVoOVNpWMpxf1wZNpt4y9h10odCNrqnYp1OBzRktckBe3sA==\n\nwebidl-conversions@^3.0.0:\n  version \"3.0.1\"\n  resolved \"https://registry.yarnpkg.com/webidl-conversions/-/webidl-conversions-3.0.1.tgz#24534275e2a7bc6be7bc86611cc16ae0a5654871\"\n  integrity sha512-2JAn3z8AR6rjK8Sm8orRC0h/bcl/DqL7tRPdGZ4I1CjdF+EaMLmYxBHyXuKL849eucPFhvBoxMsflfOb8kxaeQ==\n\nwhatwg-url@^5.0.0:\n  version \"5.0.0\"\n  resolved \"https://registry.yarnpkg.com/whatwg-url/-/whatwg-url-5.0.0.tgz#966454e8765462e37644d3626f6742ce8b70965d\"\n  integrity sha512-saE57nupxk6v3HY35+jzBwYa0rKSy0XR8JSxZPwgLr7ys0IBzhGviA1/TUGJLmSVqs8pb9AnvICXEuOHLprYTw==\n  dependencies:\n    tr46 \"~0.0.3\"\n    webidl-conversions \"^3.0.0\"\n\nws@^8.18.0:\n  version \"8.18.3\"\n  resolved \"https://registry.yarnpkg.com/ws/-/ws-8.18.3.tgz#b56b88abffde62791c639170400c93dcb0c95472\"\n  integrity sha512-PEIGCY5tSlUt50cqyMXfCzX+oOPqN0vuGqWzbcJ2xvnkzkq46oOpz7dQaTDBdfICb4N14+GARUDw2XV2N4tvzg==\n\nzod@^4.1.11:\n  version \"4.1.11\"\n  resolved \"https://registry.yarnpkg.com/zod/-/zod-4.1.11.tgz#4aab62f76cfd45e6c6166519ba31b2ea019f75f5\"\n  integrity sha512-WPsqwxITS2tzx1bzhIKsEs19ABD5vmCVa4xBo2tq/SrV4RNZtfws1EnCWQXM6yh8bD08a1idvkB5MZSBiZsjwg==\n",
        "isBinary": false,
        "encoding": "utf-8"
    }
]